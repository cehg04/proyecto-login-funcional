{% extends "base.html" %}

{% block title %}Recepción de Entrega{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-dark"><i class="bi bi-box-seam me-2"></i>Recepción de Entrega</h2>
        <a href="/recepcionentrega.html" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Volver
        </a>
    </div>

    <div class="card mb-4 shadow-sm border-0 rounded-4">
        <div class="card-header bg-dark text-white rounded-top-4 fw-semibold">Información General</div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-3 fw-semibold">Empresa:</div>
                <div class="col-md-3" id="empresa_nombre"></div>
                <div class="col-md-3 fw-semibold">Número Entrega:</div>
                <div class="col-md-3" id="num_entrega"></div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-semibold">Tipo Entrega:</div>
                <div class="col-md-3" id="tipo_entrega"></div>
                <div class="col-md-3 fw-semibold">Entregado A:</div>
                <div class="col-md-3" id="usuario_entrega"></div>
            </div>
            <div class="row mb-3">
                <div class="col-md-3 fw-semibold">Estado:</div>
                <div class="col-md-3" id="estado"></div>
            </div>
        </div>
    </div>

    <div id="tablaDCContainer" style="display: none;">
        <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" id="selectAllDC">
            <label class="form-check-label fw-semibold" for="selectAllDC">Seleccionar todo</label>
        </div>
        <table id="tablaDC" class="table table-hover table-striped table-bordered align-middle mb-0">
            <thead class="table-secondary">
                <tr>
                    <th>Recibido</th>
                    <th>Número Factura</th>
                    <th class="text-center">Proveedor</th>
                    <th>Monto</th>
                    <th>Retención IVA</th>
                    <th>Retención ISR</th>
                    <th>Número Ret. IVA</th>
                    <th>Número Ret. ISR</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="accionesDC" class="mt-3 text-end">
            <button id="btnGuardarDC" class="btn btn-primary">Guardar Selección</button>

            <button id="btnRecibirDC" class="btn btn-success" style="display: none;">Confirmar Recepción Parcial</button>
        </div>
    </div>

    <div id="tablaDSContainer" style="display: none;" class="mt-5">
        <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" id="selectAllDS">
            <label class="form-check-label fw-semibold" for="selectAllDS">Seleccionar todo</label>
        </div>
        <table id="tablaDS" class="table table-hover table-striped table-bordered align-middle mb-0">
            <thead class="table-secondary">
                <tr>
                    <th>Recibido</th>
                    <th>Tipo Documento</th>
                    <th>Proveedor</th>
                    <th>Nombre Solicitud</th>
                    <th>Número Documento</th>
                    <th>Monto</th>
                    <th>No Ret. IVA</th>
                    <th>No Ret. ISR</th>
                    <th>Observaciones</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="accionesDS" class="mt-3 text-end">
            <button id="btnGuardarDS" class="btn btn-primary">Guardar Selección</button>
 
            <button id="btnRecibirDS" class="btn btn-success" style="display: none;">Confirmar Recepción Parcial</button>
        </div>
    </div>
</div>

<div class="modal fade" id="modalConfirmarParcial" tabindex="-1" aria-labelledby="modalConfirmarParcialLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg border-0 rounded-4">
      <div class="modal-header bg-success text-white rounded-top-4">
        <h5 class="modal-title" id="modalConfirmarParcialLabel"><i class="bi bi-check2-circle me-2"></i>Confirmar Recepción Parcial</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p class="mb-2">Escribe un comentario para la recepción parcial:</p>
        <textarea id="comentarioParcial" class="form-control" rows="3" placeholder="Escribe tu comentario aquí..." required></textarea>
        <small class="text-danger d-none" id="comentarioParcialError">El comentario es obligatorio</small>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-success" id="btnGuardarComentarioParcial">Confirmar Parcial</button>
      </div>
    </div>
  </div>
</div>


{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/static/js/validar_permisos.js"></script>
<script src="/static/js/recepcioncompleta.js"></script>
{% endblock %}


